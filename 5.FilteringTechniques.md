# Filtering Techniques in SQL

This document covers various filtering techniques used in SQL queries.

## Key Concepts

- **IS NULL**: Checks for non-recorded (missing) values.
- **IS NOT NULL**: Checks for values that are not empty/missing.
- **NULLIF**: Returns NULL if two expressions are equal. Useful for handling empty strings as NULLs.
- **IN**: Comparison operator that allows you to specify multiple values in a WHERE clause (acts like multiple OR conditions).
- **NOT IN**: Comparison operator that excludes multiple values (acts like multiple NOT OR conditions).
- **BETWEEN**: Selects values within a given range.
- **NOT BETWEEN**: Selects values outside a given range.
- **LIKE**: Used for pattern matching.
  - `%`: Represents any sequence of zero or more characters.
  - `_`: Represents any single character.
  - `\`: Escape character used to treat wildcard characters as literals.
- **NOT LIKE**: Used to exclude patterns.

---

## Database Setup

First, let's create the database and the necessary table.

```sql
CREATE DATABASE IF NOT EXISTS filter_db;

USE filter_db;

CREATE TABLE IF NOT EXISTS users (
  id                INT PRIMARY KEY AUTO_INCREMENT,
  email             VARCHAR(120) NOT NULL,
  full_name         VARCHAR(80)  NOT NULL,
  city              VARCHAR(60)  NULL,          
  signup_at_utc     DATETIME     NOT NULL,     
  last_purchase_inr DECIMAL(10,2) NULL,        
  last_coupon_code  VARCHAR(30)  NULL,          
  is_active         TINYINT(1)   NOT NULL DEFAULT 1
);
```

## Data Population

Populate the `users` table with sample data.

```sql
INSERT INTO users
(email, full_name, city, signup_at_utc, last_purchase_inr, last_coupon_code, is_active)
VALUES
('raj@tuf.com',              'Raj',            'Bengaluru', '2025-12-01 00:00:00',  999.00, 'WELCOME10',    1),
('test_user1@gmail.com',     'Test User One',  'Delhi',     '2025-12-05 10:00:00',  499.00, NULL,          1),
('testXuser2@gmail.com',     'Test User Two',  'Delhi',     '2025-12-10 12:00:00',  750.00, 'WELCOME_2026', 1),
('aayush@company.com',       'Aayush',         NULL,        '2025-11-30 23:59:59',  NULL,   NULL,          1),
('neha@example.com',         'Neha',           '',          '2025-12-31 23:59:59',  1500.00,'TUF_50',       1),
('mohit@gmail.com',          'Mohit',          'Mumbai',    '2026-01-01 00:00:00',  299.00, 'NEWYEAR10',    1),
('sara@tuf.com',             'Sara',           'Bengaluru', '2025-10-10 05:00:00',  2000.00,NULL,          1),
('arjun@yahoo.com',          'Arjun',          'Pune',      '2025-12-20 09:00:00',  799.00, 'FLASH_SALE',   0),
('john.doe@gmail.com',       'John Doe',       'Chennai',   '2025-12-05 18:30:00',  300.00, NULL,          1),
('jane_doe@gmail.com',       'Jane Doe',       'Chennai',   '2025-12-06 18:30:00',  1200.00,'WELCOME_BACK',1),
('support+trial@tuf.com',    'Support Trial',  'Gurugram',  '2025-12-07 10:00:00',  NULL,   NULL,          1),
('priya@outlook.com',        'Priya',          'Hyderabad', '2025-12-08 10:00:00',  999.00, 'WELCOME10',    1),
('sameer@rediffmail.com',    'Sameer',         NULL,        '2025-12-09 10:00:00',  100.00, NULL,          1),
('emptycity@demo.com',       'Empty City',     ' ',         '2025-12-10 10:00:00',  499.00, NULL,          1),
('khushi@gmail.com',         'Khushi',         'Delhi',     '2025-12-11 10:00:00',  500.00, 'REFERRAL5',    1),
('promo@demo.com',           'Promo',          'Mumbai',    '2025-12-25 00:00:00',  1499.00,'TUF_50',       1),
('intern@tuf.com',           'Intern',         'Bengaluru', '2025-12-22 20:00:00',  899.00, 'WELCOME_BACK', 1),
('hello@sample.com',         'Hello',          'Delhi',     '2025-12-02 08:00:00',  NULL,   NULL,           1);
```

## Creating Indexes

Creating indexes improves query performance on frequently searched columns.

```sql
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_signup_at_utc ON users(signup_at_utc);
CREATE INDEX idx_users_city ON users(city);

SHOW INDEX FROM users;
```

---

## Usage Examples

### 1. IS NULL
Retrieve users where the city is not recorded (NULL).

```sql
SELECT id, email, city FROM users WHERE city IS NULL;
```

### 2. IS NOT NULL
Retrieve users where the city is recorded (not NULL).

```sql
SELECT id, email, city FROM users WHERE city IS NOT NULL;
```

### 3. NULLIF (Normalization for Missing Values)
Sometimes empty strings `''` or whitespace `' '` should be treated as NULL. We can use `NULLIF` with `TRIM` to handle this.

```sql
SELECT id, email, city FROM users WHERE NULLIF(TRIM(city), '') IS NOT NULL;
```

### 4. IN
Retrieve users who are from specific cities (e.g., Delhi or Pune).

```sql
SELECT id, email, city FROM users WHERE city IN ('Delhi', 'Pune');
```

### 5. NOT IN
Retrieve users who are NOT from specific cities.

```sql
SELECT id, email, city FROM users WHERE city NOT IN ('Delhi', 'Pune');
```

Combining with `NULLIF` to ensure we filter out true NULLs or empty/whitespace values if needed:

```sql
SELECT id, email, city 
FROM users 
WHERE city NOT IN ('Delhi', 'Pune') 
AND (NULLIF(TRIM(city), '') IS NOT NULL);
```

### 6. BETWEEN
Retrieve users who signed up within a specific date range.

```sql
SELECT id, email, signup_at_utc 
FROM users 
WHERE signup_at_utc BETWEEN '2025-12-01 00:00:00' AND '2025-12-31 23:59:59';
```

### 7. NOT BETWEEN
Retrieve users who signed up outside a specific date range.

```sql
SELECT id, email, signup_at_utc 
FROM users 
WHERE signup_at_utc NOT BETWEEN '2025-12-01 00:00:00' AND '2025-12-31 23:59:59';
```

### 8. LIKE
Pattern matching examples.

- Emails ending with `@tuf.com`:
```sql
SELECT email FROM users WHERE email LIKE '%@tuf.com';
```

- Emails starting with `test`:
```sql
SELECT email FROM users WHERE email LIKE 'test%';
```

- Emails starting with `test_user` (using escape character `\` for the underscore):
```sql
SELECT email FROM users WHERE email LIKE 'test\_user%';
```

### 9. NOT LIKE
Retrieve emails that do NOT match a pattern (e.g., do not end with `@tuf.com`).

```sql
SELECT email FROM users WHERE email NOT LIKE '%@tuf.com';
```